<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate Pearson correlations with complex survey data — svycor • jtools</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">jtools</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/categorical.html">Plotting interactions among categorical variables in regression models</a>
    </li>
    <li>
      <a href="../articles/interactions.html">Exploring interactions with continuous predictors in regression models</a>
    </li>
    <li>
      <a href="../articles/summ.html">Tools for summarizing and visualizing regression models</a>
    </li>
    <li>
      <a href="../articles/svycor.html">Calculate correlations and correlation tables with complex survey data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jacob-long/jtools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate Pearson correlations with complex survey data</h1>
    </div>

    
    <p><code>svycor</code> extends the <code>survey</code> package by calculating correlations
with syntax similar to the original package, which for reasons unknown lacks
such a function.</p>
    

    <pre class="usage"><span class='fu'>svycor</span>(<span class='no'>formula</span>, <span class='no'>design</span>, <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>digits</span> <span class='kw'>=</span> <span class='fu'>getOption</span>(<span class='st'>"jtools-digits"</span>,
  <span class='kw'>default</span> <span class='kw'>=</span> <span class='fl'>2</span>), <span class='kw'>sig.stats</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>bootn</span> <span class='kw'>=</span> <span class='fl'>1000</span>, <span class='kw'>mean1</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>A formula (e.g., ~var1+var2) specifying the terms to correlate.</p></td>
    </tr>
    <tr>
      <th>design</th>
      <td><p>The <code>survey.design</code> or <code>svyrep.design</code> object.</p></td>
    </tr>
    <tr>
      <th>na.rm</th>
      <td><p>Logical. Should cases with missing values be dropped?</p></td>
    </tr>
    <tr>
      <th>digits</th>
      <td><p>An integer specifying the number of digits past the decimal to
report in the output. Default is 2. You can change the default number of
digits for all jtools functions with
<code>options("jtools-digits" = digits)</code> where digits is the desired number.</p></td>
    </tr>
    <tr>
      <th>sig.stats</th>
      <td><p>Logical. Perform non-parametric bootstrapping
(using <code><a href='http://www.rdocumentation.org/packages/weights/topics/wtd.cor'>wtd.cor</a></code>) to generate standard errors and
associated t- and p-values. See details for some considerations when doing
null hypothesis testing with complex survey correlations.</p></td>
    </tr>
    <tr>
      <th>bootn</th>
      <td><p>If <code>sig.stats</code> is TRUE, this defines the number of bootstraps
to be run to generate the standard errors and p-values. For large values and
large datasets, this can contribute considerably to processing time.</p></td>
    </tr>
    <tr>
      <th>mean1</th>
      <td><p>If <code>sig.stats</code> is TRUE, it is important to know whether the
sampling weights should have a mean of 1. That is, should the standard errors
be calculated as if the number of rows in your dataset is the total number of
observations (TRUE) or as if the sum of the weights in your dataset is the
total number of observations (FALSE)?</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passed to <code><a href='http://www.rdocumentation.org/packages/survey/topics/surveysummary'>svyvar</a></code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>If significance tests are not requested, there is one returned value:</p>
<p></p>
<dt>cors</dt><dd><p>The correlation matrix (without rounding)</p></dd>

 If significance tests are requested, the following are also returned:

 <dt>p.values</dt><dd><p>A matrix of p values</p></dd>
 <dt>t.values</dt><dd><p>A matrix of t values</p></dd>
 <dt>std.err</dt><dd><p>A matrix of standard errors</p></dd>

    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function extends the <code>survey</code> package by calculating the correlations
  for user-specified variables in survey design and returning a correlation matrix.</p>
<p>Using the <code><a href='http://www.rdocumentation.org/packages/weights/topics/wtd.cor'>wtd.cor</a></code> function, this function also returns
  standard errors and p-values for the correlation terms using a sample-weighted
  bootstrapping procedure. While correlations do not require distributional
  assumptions, hypothesis testing (i.e., \(r &gt; 0\)) does. The appropriate way to
  calculate standard errors and use them to define a probability is not straightforward
  in this scenario since the weighting causes heteroskedasticity, thereby violating
  an assumption inherent in the commonly used methods for converting Pearson's
  correlations into t-values. The method provided here is defensible, but if
  reporting in scientific publications the method should be spelled out.</p>
    
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>This function was designed in part on the procedure recommended by Thomas
  Lumley, the author of the survey package, on
  <a href='http://stackoverflow.com/questions/34418822/pearson-correlation-coefficient-in-rs-survey-package#41031088'>Stack Overflow</a>. However, he has not reviewed or endorsed this implementation.
  All defects are attributed to the author.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='http://www.rdocumentation.org/packages/weights/topics/wtd.cor'>wtd.cor</a></code>, <code><a href='http://www.rdocumentation.org/packages/survey/topics/surveysummary'>svyvar</a></code></p>
<p>Other <span class="pkg">survey</span> package extensions: <code><a href='svysd.html'>svysd</a></code></p>
<p>Other survey tools: <code><a href='pf_sv_test.html'>pf_sv_test</a></code>,
  <code><a href='svysd.html'>svysd</a></code>, <code><a href='weights_tests.html'>weights_tests</a></code>,
  <code><a href='wgttest.html'>wgttest</a></code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'> <span class='fu'>library</span>(<span class='no'>survey</span>)
 <span class='fu'>data</span>(<span class='no'>api</span>)
 <span class='co'># Create survey design object</span>
 <span class='no'>dstrat</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/survey/topics/svydesign'>svydesign</a></span>(<span class='kw'>id</span> <span class='kw'>=</span> ~<span class='fl'>1</span>,<span class='kw'>strata</span> <span class='kw'>=</span> ~<span class='no'>stype</span>, <span class='kw'>weights</span> <span class='kw'>=</span> ~<span class='no'>pw</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>apistrat</span>,
                     <span class='kw'>fpc</span><span class='kw'>=</span>~<span class='no'>fpc</span>)

 <span class='co'># Print correlation matrix</span>
 <span class='fu'>svycor</span>(~<span class='no'>api00</span>+<span class='no'>api99</span>+<span class='no'>dnum</span>, <span class='kw'>design</span> <span class='kw'>=</span> <span class='no'>dstrat</span>)</div><div class='output co'>#&gt;       api00 api99 dnum
#&gt; api00  1.00  0.98 0.25
#&gt; api99  0.98  1.00 0.24
#&gt; dnum   0.25  0.24 1.00</div><div class='input'>
 <span class='co'># Save the results, extract correlation matrix</span>
 <span class='no'>out</span> <span class='kw'>&lt;-</span> <span class='fu'>svycor</span>(~<span class='no'>api00</span>+<span class='no'>api99</span>+<span class='no'>dnum</span>, <span class='kw'>design</span> <span class='kw'>=</span> <span class='no'>dstrat</span>)
 <span class='no'>out</span>$<span class='no'>cors</span></div><div class='output co'>#&gt;           api00     api99      dnum
#&gt; api00 1.0000000 0.9759047 0.2543484
#&gt; api99 0.9759047 1.0000000 0.2441910
#&gt; dnum  0.2543484 0.2441910 1.0000000</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#note">Note</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Jacob Long &lt;<a href='mailto:long.1377@osu.edu'>long.1377@osu.edu</a>&gt;

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Jacob A. Long.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
