<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Test whether sampling weights are needed — wgttest • jtools</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">jtools</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/categorical.html">Plotting interactions among categorical variables in regression models</a>
    </li>
    <li>
      <a href="../articles/interactions.html">Exploring interactions with continuous predictors in regression models</a>
    </li>
    <li>
      <a href="../articles/summ.html">Tools for summarizing and visualizing regression models</a>
    </li>
    <li>
      <a href="../articles/svycor.html">Calculate correlations and correlation tables with complex survey data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jacob-long/jtools">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Test whether sampling weights are needed</h1>
    </div>

    
    <p>Use the DuMouchel-Duncan (1983) test to assess the need for sampling weights
in your linear regression analysis.</p>
    

    <pre class="usage"><span class='fu'>wgttest</span>(<span class='no'>model</span>, <span class='no'>weights</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>model_output</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>test</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>digits</span> <span class='kw'>=</span> <span class='fu'>getOption</span>(<span class='st'>"jtools-digits"</span>, <span class='kw'>default</span> <span class='kw'>=</span> <span class='fl'>3</span>))</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>model</th>
      <td><p>The unweighted linear model (must be <code>lm</code>,
<code>glm</code>, see details for other types) you want to check.</p></td>
    </tr>
    <tr>
      <th>weights</th>
      <td><p>The name of the weights column in <code>model</code>'s data frame
or a vector of weights equal in length to the number of observations
included in <code>model</code>.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>The data frame with the data fed to the fitted model and the
weights</p></td>
    </tr>
    <tr>
      <th>model_output</th>
      <td><p>Should a summary of the model with weights as predictor
be printed? Default is TRUE, but you may not want it if you are trying to
declutter a document.</p></td>
    </tr>
    <tr>
      <th>test</th>
      <td><p>Which type of test should be used in the ANOVA? The default,
<code>NULL</code>, chooses based on the model type ("F" for linear models).
This argument is passed to <code>anova</code>.</p></td>
    </tr>
    <tr>
      <th>digits</th>
      <td><p>An integer specifying the number of digits past the decimal to
report in the output. Default is 3. You can change the default number of
digits for all jtools functions with
<code>options("jtools-digits" = digits)</code> where digits is the desired number.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This is designed to be similar to the <code>wgttest</code> macro for Stata
(<a href='http://fmwww.bc.edu/repec/bocode/w/wgttest.html'>http://fmwww.bc.edu/repec/bocode/w/wgttest.html</a>). This method,
advocated for by DuMouchel and Duncan (1983), is fairly straightforward. To
decide whether weights are needed, the weights are added to the linear model
as a predictor and interaction with each other predictor. Then, an omnibus
test of significance is performed to compare the weights-added model to the
original; if insignificant, weights are not significantly related to the
result and you can use the more efficient estimation from unweighted OLS.</p>
<p>It can be helpful to look at the created model using <code>model_output = TRUE</code>
to see which variables might be the ones affected by inclusion of weights.</p>
<p>This test can support most GLMs in addition to LMs, a use validated by
Nordberg (1989). This, to my knowledge, is different from the Stata macro.
It does not work for mixed models (e.g., <code>lmer</code> or <code>lme</code>) though
it could plausibly be
implemented. However, there is no scholarly consensus how to properly
incorporate weights into mixed models. There are other types of models that
may work, but have not been tested. The function is designed to be
compatible with as many model types as possible, but the user should be
careful to make sure s/he understands whether this type of test is
appropriate for the model being considered. DuMouchel and Duncan (1983) were
only thinking about linear regression when the test was conceived.
Nordberg (1989) validated its use with generalized linear models, but to
this author's knowledge it has not been tested with other model types.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>DuMouchel, W. H. &amp; Duncan, D.J. (1983). Using sample survey weights in
  multiple regression analyses of stratified samples. <em>Journal of the
  American Statistical Association</em>, <em>78</em>. 535-543.</p>
<p>Nordberg, L. (1989). Generalized linear modeling of sample survey data.
  <em>Journal of Official Statistics; Stockholm</em>, <em>5</em>, 223–239.</p>
<p>Winship, C. &amp; Radbill, L. (1994). Sampling weights and regression
  analysis. <em>Sociological Methods and Research</em>, <em>23</em>, 230-257.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p>Other survey tools: <code><a href='pf_sv_test.html'>pf_sv_test</a></code>,
  <code><a href='svycor.html'>svycor</a></code>, <code><a href='svysd.html'>svysd</a></code>,
  <code><a href='weights_tests.html'>weights_tests</a></code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># First, let's create some fake sampling weights</span>
<span class='no'>wts</span> <span class='kw'>&lt;-</span> <span class='fu'>runif</span>(<span class='fl'>50</span>, <span class='fl'>0</span>, <span class='fl'>5</span>)
<span class='co'># Create model</span>
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>lm</span>(<span class='no'>Income</span> ~ <span class='no'>Frost</span> + <span class='no'>Illiteracy</span> + <span class='no'>Murder</span>,
          <span class='kw'>data</span> <span class='kw'>=</span> <span class='fu'>as.data.frame</span>(<span class='no'>state.x77</span>))
<span class='co'># See if the weights change the model</span>
<span class='fu'>wgttest</span>(<span class='no'>fit</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='no'>wts</span>)</div><div class='output co'>#&gt; DuMouchel-Duncan test of model change with weights
#&gt; 
#&gt; F(4,42) = 1.665
#&gt; p = 0.176
#&gt; 
#&gt; Lower p values indicate greater influence of the weights.</div><div class='input'>
<span class='co'># With a GLM</span>
<span class='no'>wts</span> <span class='kw'>&lt;-</span> <span class='fu'>runif</span>(<span class='fl'>100</span>, <span class='fl'>0</span>, <span class='fl'>2</span>)
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>rnorm</span>(<span class='fl'>100</span>)
<span class='no'>y</span> <span class='kw'>&lt;-</span> <span class='fu'>rbinom</span>(<span class='fl'>100</span>, <span class='fl'>1</span>, <span class='fl'>.5</span>)
<span class='no'>fit</span> <span class='kw'>&lt;-</span> <span class='fu'>glm</span>(<span class='no'>y</span> ~ <span class='no'>x</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='no'>binomial</span>)
<span class='fu'>wgttest</span>(<span class='no'>fit</span>, <span class='no'>wts</span>)</div><div class='output co'>#&gt; DuMouchel-Duncan test of model change with weights
#&gt; 
#&gt; Deviance (2) = 1.164
#&gt; p = 0.559
#&gt; 
#&gt; Lower p values indicate greater influence of the weights.</div><div class='input'><span class='co'>## Can specify test manually</span>
<span class='fu'>wgttest</span>(<span class='no'>fit</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='no'>wts</span>, <span class='kw'>test</span> <span class='kw'>=</span> <span class='st'>"Rao"</span>)</div><div class='output co'>#&gt; DuMouchel-Duncan test of model change with weights
#&gt; 
#&gt; Rao (2,96) = 1.156
#&gt; p = 0.561
#&gt; 
#&gt; Lower p values indicate greater influence of the weights.</div><div class='input'>
<span class='co'># Quasi family is treated differently than likelihood-based</span>
<span class='co'>## Dobson (1990) Page 93: Randomized Controlled Trial (plus some extra values):</span>
<span class='no'>counts</span> <span class='kw'>&lt;-</span> <span class='fu'>c</span>(<span class='fl'>18</span>,<span class='fl'>17</span>,<span class='fl'>15</span>,<span class='fl'>20</span>,<span class='fl'>10</span>,<span class='fl'>20</span>,<span class='fl'>25</span>,<span class='fl'>13</span>,<span class='fl'>12</span>,<span class='fl'>18</span>,<span class='fl'>17</span>,<span class='fl'>15</span>,<span class='fl'>20</span>,<span class='fl'>10</span>,<span class='fl'>20</span>,<span class='fl'>25</span>,<span class='fl'>13</span>,<span class='fl'>12</span>)
<span class='no'>outcome</span> <span class='kw'>&lt;-</span> <span class='fu'>gl</span>(<span class='fl'>3</span>,<span class='fl'>1</span>,<span class='fl'>18</span>)
<span class='no'>treatment</span> <span class='kw'>&lt;-</span> <span class='fu'>gl</span>(<span class='fl'>3</span>,<span class='fl'>6</span>)
<span class='no'>glm.D93</span> <span class='kw'>&lt;-</span> <span class='fu'>glm</span>(<span class='no'>counts</span> ~ <span class='no'>outcome</span> + <span class='no'>treatment</span>, <span class='kw'>family</span> <span class='kw'>=</span> <span class='no'>quasipoisson</span>)
<span class='no'>wts</span> <span class='kw'>&lt;-</span> <span class='fu'>runif</span>(<span class='fl'>18</span>, <span class='fl'>0</span>, <span class='fl'>3</span>)
<span class='fu'>wgttest</span>(<span class='no'>glm.D93</span>, <span class='kw'>weights</span> <span class='kw'>=</span> <span class='no'>wts</span>)</div><div class='output co'>#&gt; DuMouchel-Duncan test of model change with weights
#&gt; 
#&gt; F(5,8) = 0.304
#&gt; p = 0.897
#&gt; 
#&gt; Lower p values indicate greater influence of the weights.</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Jacob A. Long.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
